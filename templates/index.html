<!DOCTYPE html>
<html lang="zh-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人简历生成器</title>
    <script src="static/js/vue.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.0.2/marked.min.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <script>
        // 本地备份加载（如果 CDN 失败）
        if (typeof html2pdf === 'undefined') {
            document.write('<script src="static/js/html2pdf.bundle.min.js"><\/script>');
        }
    </script>
    <style>
        /* A4 Metric Reference */
        #a4-reference {
            width: 210mm;
            height: 297mm;
            position: absolute;
            top: -9999px;
            visibility: hidden;
        }

        body { font-family: 'Helvetica Neue', Arial, sans-serif; background: #f0f2f5; margin: 0; padding: 0; height: 100vh; overflow-x: auto; overflow-y: hidden; display: flex; flex-direction: column; min-height: 600px; }
        
        /* Top Navigation Bar */
        .top-nav {
            background: white;
            padding: 0 40px;
            height: 60px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
            flex-shrink: 0; /* Prevent header from shrinking */
            z-index: 10;
            min-width: 1000px; /* Ensure nav matches main content width */
        }
        .logo {
            display: flex;
            align-items: center;
            color: #1890ff;
            font-size: 20px;
            font-weight: bold;
        }
        .logo i { margin-right: 10px; font-size: 24px; }
        .nav-items {
            display: flex;
            gap: 20px;
            color: #333;
        }
        .nav-item { cursor: pointer; display: flex; align-items: center; gap: 5px; }
        .nav-item:hover { color: #1890ff; }

        /* Main Container */
        .main-wrapper {
            max-width: 100%; /* Full width */
            margin: 0;
            padding: 10px;
            display: flex;
            gap: 10px;
            flex: 1; /* Take remaining height */
            height: calc(100% - 60px); /* Explicit height */
            box-sizing: border-box;
            background: #f0f2f5;
            min-width: 1000px; /* Minimum width to prevent layout breaking */
            overflow: hidden;
        }

        /* Editor Panel (Left) */
        .editor-panel {
            flex: 1;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            height: 100%; /* Fill container */
            min-width: 400px; /* Minimum width for editor */
            min-height: 0; /* Important for flex child scroll */
        }
        .editor-header-row {
            padding: 20px 20px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .editor-title { font-size: 18px; font-weight: bold; color: #333; }
        .editor-actions { display: flex; gap: 15px; color: #1890ff; font-size: 14px; cursor: pointer; }
        
        /* Tabs */
        .tabs {
            display: flex;
            padding: 0 20px;
            border-bottom: 1px solid #eee;
            margin-top: 15px;
            overflow-x: auto;
        }
        .tab-item {
            padding: 12px 0;
            margin-right: 25px;
            cursor: pointer;
            color: #333;
            font-size: 14px;
            white-space: nowrap;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }
        .tab-item.active {
            color: #1890ff;
            border-bottom-color: #1890ff;
            font-weight: bold;
        }
        
        /* Editor Content Area */
        .editor-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        /* Preview Panel (Right) */
        .preview-panel {
            flex: 1.2;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            position: relative;
            height: 100%; /* Fill container */
            min-width: 500px; /* Minimum width for preview */
            min-height: 0; /* Important for flex child scroll */
        }
        .preview-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .preview-title { font-weight: bold; color: #333; }
        .preview-scroll-area {
            flex: 1;
            overflow-y: auto;
            background: #e8eaec; /* 灰色背景衬托A4纸 */
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        
        /* A4 Paper Style */
        .resume-paper {
            width: 210mm;
            min-height: 297mm;
            background: white; /* Default to white */
            padding: 40px; /* 页边距 */
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); /* Default shadow */
            box-sizing: border-box;
            position: relative;
        }
        
        /* Pagination Active State */
        .resume-paper.show-pagination {
            background-color: transparent; /* Transparent for gradient gaps */
            box-shadow: none; /* Remove box shadow, use filter instead */
            filter: drop-shadow(0 2px 8px rgba(0,0,0,0.1));
        }

        /* Pagination Styles */
        .new-page-start {
            position: relative;
        }
        
        /* Pagination Footer (Page Number) */
        .new-page-start::before {
            display: none; /* Hide page number */
        }

        /* Visual Gap - Hidden (handled by transparent paper) */
        .new-page-start::after {
            display: none;
        }

        /* Hide pagination effects during export and force native breaks */
        body.exporting .new-page-start::before,
        body.exporting .new-page-start::after {
            display: none !important;
        }
        
        body.exporting .print-spacer {
            height: 60px !important; /* Fixed top margin on new page in PDF */
            page-break-before: always;
            break-before: page;
            display: block !important; /* Ensure block display to suppress list markers on LIs */
            list-style: none !important; /* Double safety */
            visibility: hidden;
            margin: 0 !important;
            padding: 0 !important;
            border: none !important;
        }

        body.exporting .new-page-start {
            /* Clean up old styles */
            margin-top: 0 !important;
            border-top: none !important;
            padding-top: 0 !important;
        }

        /* 导出 PDF 样式 */
        /* body.exporting .main-wrapper { display: none; } - Removed to fix html2canvas rendering */
        body.exporting .resume-paper {
            margin: 0;
            box-shadow: none;
            filter: none;
            background-image: none !important;
            background-color: white !important;
            width: 210mm;
            min-height: 297mm;
            padding: 20px; /* 导出时边距 */
        }
        .editor-bottom {
            padding: 15px 20px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
        }
        .preview-bottom {
            padding: 15px 20px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            background: white;
        }
        
        /* Buttons */
        .btn-save { background: #1890ff; color: white; padding: 8px 24px; border-radius: 4px; }
        .btn-outline { border: 1px solid #ddd; background: white; color: #666; padding: 8px 20px; border-radius: 4px; }
        .btn-export { background: #1890ff; color: white; padding: 8px 20px; border-radius: 4px; }
        
        /* Override old styles */
        .container { max-width: none; margin: 0; display: flex; gap: 0; }
        .editor { display: none; } /* Hide old editor class */
        
        /* Quill Override */
        .ql-toolbar { 
            border: 1px solid #d9d9d9 !important; 
            border-bottom: none !important; 
            background: #fff !important; 
            border-radius: 4px 4px 0 0;
            padding: 8px !important;
        }
        .ql-container { 
            border: 1px solid #d9d9d9 !important; 
            border-radius: 0 0 4px 4px; 
            height: 300px; 
            font-size: 14px;
            font-family: 'Consolas', 'Monaco', monospace; /* 模拟代码风格字体 */
        }
        .ql-editor {
            line-height: 1.8;
            color: #333;
        }
        
        /* Resume Content Styles - Dynamic Variables */
        #resume-preview {
            --theme-color: #1890ff;
            --heading-size: 16px;
            --content-size: 14px;
            --module-spacing: 25px;
            --line-height: 1.5;
            --name-size: 24px;
            --avatar-scale: 1;
        }

        .resume-section {
            margin-bottom: var(--module-spacing);
        }

        .resume-section h3 {
            color: var(--theme-color);
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
            margin-top: 0;
            margin-bottom: 15px;
            font-size: var(--heading-size);
            display: flex;
            align-items: center;
        }

        .resume-section h3::before {
            /* Optional: Add a decorative element for certain templates */
            content: '';
            display: none; 
        }

        .resume-item-header {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: calc(var(--content-size) + 1px);
        }
        .resume-item-subtitle {
            color: #666;
            margin-bottom: 8px;
            font-size: var(--content-size);
        }
        .resume-desc {
            font-size: var(--content-size);
            line-height: var(--line-height);
            color: #333;
        }
        .resume-desc ul {
            padding-left: 20px;
            margin-top: 5px;
            margin-bottom: 5px;
        }
        .resume-desc li {
            margin-bottom: 2px;
        }
        .resume-header h1 {
            font-size: var(--name-size); /* Dynamic name size */
            margin-bottom: 10px;
        }
        .resume-header p {
            font-size: var(--content-size);
            line-height: var(--line-height);
        }
        
        /* Template: Modern (Default) */
        .template-modern .resume-section h3 {
            border-bottom: 2px solid #eee;
            border-bottom-color: rgba(0,0,0,0.1);
        }

        /* Template: Classic */
        .template-classic .resume-header {
            text-align: center;
            border-bottom: 2px solid var(--theme-color);
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .template-classic .resume-section h3 {
            background: #f9f9f9;
            padding: 8px 15px;
            border-left: 4px solid var(--theme-color);
            border-bottom: none;
        }

        /* Template: Simple */
        .template-simple .resume-section h3 {
            border-bottom: 1px solid #000;
            color: #000 !important; /* Force black headers */
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .template-simple .resume-header {
            text-align: left;
            border-bottom: none;
        }
        
        /* Floating Chat Button */
        .floating-chat {
            position: absolute;
            bottom: 80px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: #52c41a;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            cursor: pointer;
        }

        /* 导出 PDF 样式 */
        /* body.exporting .main-wrapper { display: none; } - Removed to fix html2canvas rendering */
        body.exporting .resume-paper {
            margin: 0;
            box-shadow: none;
            width: 210mm;
            min-height: 297mm;
            padding: 20px; /* 导出时边距 */
        }
        
        /* Module Title with Icon */
        .module-header {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
            font-size: 18px;
        }
        .module-header i { color: #1890ff; margin-right: 10px; font-size: 20px; vertical-align: middle; }
        .module-desc { color: #666; font-size: 14px; margin-bottom: 25px; margin-left: 30px; }
        
        /* Avatar Upload Section */
        .avatar-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 1px solid #f0f0f0;
        }
        .avatar-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: #eee;
            margin-bottom: 10px;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #999;
            font-size: 40px;
        }
        .avatar-preview img { width: 100%; height: 100%; object-fit: cover; }
        .avatar-tip { font-size: 12px; color: #999; margin-bottom: 15px; }
        .avatar-actions { display: flex; gap: 15px; }
        
        /* Grid Form Layout */
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-col { flex: 1; }
        
        label { display: block; margin-bottom: 8px; font-weight: bold; font-size: 14px; color: #333; }
        label.required::before { content: '* '; color: #ff4d4f; }
        
                /* Input with Icon */
        .input-wrapper { position: relative; }
        .input-wrapper i { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #999; }
        .input-wrapper input, .input-wrapper select { 
            padding-left: 35px; 
            height: 40px; 
            border: 1px solid #d9d9d9; 
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
            transition: all 0.3s;
            appearance: none;
        }
        .input-wrapper input:focus, .input-wrapper select:focus { border-color: #1890ff; box-shadow: 0 0 0 2px rgba(24,144,255,0.2); outline: none; }
        .input-wrapper.select-wrapper::after {
            content: '\f078';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            font-size: 12px;
            pointer-events: none;
        }
        .input-wrapper.select-wrapper i { left: 12px; } /* Reset icon position */
        .input-wrapper.select-wrapper select { padding-left: 35px; } /* Ensure padding */
        
        /* Select without icon (if needed) */
        .input-wrapper.select-wrapper.no-icon select { padding-left: 12px; }

        /* Custom Editor Styles */
        .skills-wrapper {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .skill-preview-card {
            background: #f9f9f9;
            border: 1px dashed #d9d9d9;
            border-radius: 6px;
            padding: 15px;
            font-size: 13px;
        }
        .skill-preview-title {
            font-weight: bold;
            color: #666;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .editor-container {
            border: 1px solid #d9d9d9;
            border-radius: 6px;
            overflow: hidden;
            transition: all 0.3s;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .editor-container:focus-within {
            border-color: #1890ff;
            box-shadow: 0 0 0 3px rgba(24,144,255,0.1);
        }
        
        .custom-editor-toolbar {
            background: #f5f7fa;
            border-bottom: 1px solid #eee;
            padding: 8px 12px;
            display: flex;
            gap: 5px;
            align-items: center;
        }
        .toolbar-group {
            display: flex;
            gap: 2px;
            padding-right: 10px;
            border-right: 1px solid #e8e8e8;
            margin-right: 10px;
        }
        .toolbar-group:last-child { border: none; }
        
        .toolbar-btn {
            cursor: pointer;
            color: #555;
            padding: 6px 10px;
            border-radius: 4px;
            transition: all 0.2s;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .toolbar-btn:hover {
            background: #e6f7ff;
            color: #1890ff;
        }
        
        .custom-textarea {
            width: 100%;
            min-height: 350px;
            border: none;
            padding: 15px;
            font-size: 14px;
            font-family: 'Consolas', 'Monaco', 'Menlo', monospace;
            line-height: 1.7;
            color: #333;
            resize: vertical;
            outline: none;
            box-sizing: border-box;
            background: white;
        }

        /* Education Card Styles */
        .edu-card {
            background: white;
            border: 1px solid #e8e8e8;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }
        .edu-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border-color: #1890ff;
        }
        .edu-info {
            flex: 1;
        }
        .edu-school {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }
        .edu-tags {
            display: flex;
            gap: 10px;
        }
        .tag-blue {
            background: #e6f7ff;
            color: #1890ff;
            border: 1px solid #91d5ff;
            border-radius: 4px;
            padding: 2px 8px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .tag-orange {
            background: #fff7e6;
            color: #fa8c16;
            border: 1px solid #ffd591;
            border-radius: 4px;
            padding: 2px 8px;
            font-size: 12px;
        }
        .edu-actions {
            display: flex;
            align-items: center;
            gap: 15px;
            color: #999;
            font-size: 13px;
        }
        .action-btn {
            cursor: pointer;
            transition: color 0.3s;
        }
        .action-btn.edit:hover { color: #1890ff; }
        .action-btn.delete:hover { color: #ff4d4f; }
        
        /* Edit Form Styles */
        .edit-form-card {
            background: white;
            border: 1px solid #e8e8e8;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #f0f0f0;
            padding-bottom: 15px;
        }
        /* Modal Styles Updated - Slide from Left */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.3); /* 更轻的遮罩 */
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-card {
            position: absolute;
            top: 0;
            left: 0;
            width: 450px; /* Reduced width from 800px */
            height: 100vh;
            max-width: 90vw;
            max-height: none;
            border-radius: 0;
            transform: translateX(-100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: white;
            box-shadow: 4px 0 16px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }
        .modal-overlay.active .modal-card {
            transform: translateX(0);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            margin: 0;
            background: #fff;
        }
        .modal-title { font-size: 18px; font-weight: bold; color: #333; display: flex; align-items: center; gap: 10px; }
        
        .config-item {
            margin-bottom: 20px;
        }
        .config-label {
            display: flex;
            align-items: center;
            font-size: 14px;
            color: #333;
            margin-bottom: 8px;
            font-weight: 500;
        }
        .config-label i {
            margin-right: 8px;
            color: #666;
            width: 16px;
            text-align: center;
        }
        .config-label .info-icon {
            margin-left: 5px;
            color: #999;
            font-size: 12px;
            cursor: pointer;
        }
        .color-swatch {
            width: 36px;
            height: 36px;
            border-radius: 4px;
            cursor: pointer;
            border: 1px solid #ddd;
        }
        .config-tabs {
            display: flex;
            border-bottom: 1px solid #eee;
            padding: 0 20px;
            background: white;
            flex-shrink: 0;
            overflow-x: auto;
        }
        .config-tab {
            padding: 15px 0;
            margin-right: 25px;
            cursor: pointer;
            color: #666;
            font-size: 14px;
            border-bottom: 2px solid transparent;
            font-weight: 500;
            white-space: nowrap;
            flex-shrink: 0;
        }
        .config-tab.active {
            color: #1890ff;
            border-bottom-color: #1890ff;
            font-weight: bold;
        }

        .modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #fcfcfc;
        }

        /* 紧凑版模块列表 */
        .module-list-enhanced {
            gap: 12px;
        }
        .module-item-enhanced {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: white;
            border: 1px solid #eee;
            border-radius: 8px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.02);
            transition: all 0.2s;
        }
        .module-item-enhanced:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-color: #e6f7ff;
        }
        .module-item-enhanced.dragging {
            opacity: 0.5;
            background: #f0f0f0;
            border: 1px dashed #999;
        }
        .module-item-enhanced.drag-over {
            border-top: 2px solid #1890ff;
        }
        .drag-handle { color: #ccc; margin-right: 15px; cursor: grab; }
        .drag-handle:active { cursor: grabbing; }
        .module-info { display: flex; align-items: center; font-size: 14px; }
        .module-icon { width: 20px; color: #1890ff; margin-right: 10px; text-align: center; }
        
        .module-toggle {
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            transition: all 0.3s;
        }
        .module-toggle.active {
            color: #52c41a; /* 绿色文字 */
            background: none;
            border: none;
        }
        .module-toggle.inactive {
            color: #999; /* 灰色文字 */
            background: none;
            border: none;
        }
        
        /* Custom Module Modal - Centered */
        .centered-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        .centered-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .centered-modal-card {
            background: white;
            border-radius: 8px;
            width: 500px;
            max-width: 90%;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateY(20px);
            transition: all 0.3s;
            overflow: hidden;
        }
        .centered-modal-overlay.active .centered-modal-card {
            transform: translateY(0);
        }
        .centered-modal-header {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .centered-modal-title {
            font-size: 18px;
            font-weight: bold;
            color: #1890ff;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .centered-modal-body {
            padding: 0 25px 25px;
        }
        .info-box {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 25px;
            color: #666;
            font-size: 13px;
            line-height: 1.6;
        }
        .info-box-title {
            color: #1890ff;
            font-weight: bold;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .info-box ul {
            margin: 0;
            padding-left: 20px;
        }
        .centered-modal-footer {
            padding: 15px 25px 25px;
            background: white;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* Checkbox Styles */
        .checkbox-wrapper {
            width: 18px;
            height: 18px;
            border-radius: 4px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 10px;
            margin-right: 4px;
            transition: all 0.2s;
        }
        .active .checkbox-wrapper { 
            background: #1890ff; 
            border: 1px solid #1890ff;
            color: white; 
        }
        .inactive .checkbox-wrapper { 
            background: white; 
            border: 1px solid #ccc; 
        }

        /* Eye Icon Styles */
        .eye-icon {
            font-size: 14px;
            margin-right: 4px;
        }
        .active .eye-icon { color: #52c41a; }
        .inactive .eye-icon { color: #ccc; }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #eee;
            background: white;
            display: flex;
            justify-content: flex-end;
            flex-shrink: 0;
        }
    </style>
</head>
<body>
    {% verbatim %}
    <div id="app" class="main-wrapper">
        <div id="a4-reference"></div>
        <!-- Editor Panel -->
        <div class="editor-panel">
            <div class="editor-header-row">
                <div class="editor-title">简历编辑器</div>
                <div class="editor-actions">
                    <span @click="showAddModuleModal = true"><i class="fas fa-plus"></i> 自定义简历模块</span>
                    <span @click="openConfigModal"><i class="fas fa-pen"></i> 自定义简历配置</span>
                </div>
            </div>
            
            <div class="tabs">
                <div class="tab-item" :class="{ active: currentTab === 'basic' }" @click="currentTab = 'basic'">基本信息</div>
                <div class="tab-item" :class="{ active: currentTab === 'projects' }" @click="currentTab = 'projects'">项目经历</div>
                <div class="tab-item" :class="{ active: currentTab === 'skills' }" @click="currentTab = 'skills'">专业技能</div>
                <div class="tab-item" :class="{ active: currentTab === 'awards' }" @click="currentTab = 'awards'">获奖经历</div>
                <div class="tab-item" :class="{ active: currentTab === 'summary' }" @click="currentTab = 'summary'">个人评价</div>
                <div class="tab-item" :class="{ active: currentTab === 'research' }" @click="currentTab = 'research'">科研成果</div>
                <div class="tab-item" :class="{ active: currentTab === 'experience' }" @click="currentTab = 'experience'">实习经历</div>
                <div class="tab-item" :class="{ active: currentTab === 'work' }" @click="currentTab = 'work'">工作经历</div>
                <div class="tab-item" :class="{ active: currentTab === 'education' }" @click="currentTab = 'education'">教育背景</div>
                <!-- Custom Modules Tabs -->
                <div class="tab-item" 
                     v-for="mod in allModules.filter(m => m.isCustom && m.visible)" 
                     :key="mod.id"
                     :class="{ active: currentTab === mod.id }" 
                     @click="currentTab = mod.id">
                    {{ mod.name }}
                </div>
            </div>

            <div class="editor-content">
                <!-- Basic Info -->
                <div v-show="currentTab === 'basic'">
                    <div class="module-header"><i class="fas fa-user"></i> <span>基本信息</span></div>
                    <div class="module-desc">填写您的基本个人信息，这些信息将显示在简历的顶部区域。</div>
                    
                    <div class="avatar-section">
                        <div class="avatar-preview">
                            <img v-if="resume.avatar" :src="resume.avatar">
                            <i v-else class="fas fa-user"></i>
                        </div>
                        <div class="avatar-tip">支持 JPG、PNG、JPEG 格式，大小不超过 1 MB</div>
                        <div class="avatar-actions">
                            <button class="btn-primary" @click="triggerUpload" style="padding: 6px 15px; font-size: 13px;">
                                <i class="fas fa-upload"></i> 上传头像
                            </button>
                            <input type="file" id="avatar-upload" @change="handleAvatarUpload" style="display: none" accept="image/*">
                            <button class="btn-outline" @click="removeAvatar" style="padding: 6px 15px; font-size: 13px; color: #ff4d4f; border-color: #ff4d4f;">
                                <i class="fas fa-times-circle"></i> 移除头像
                            </button>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label class="required">姓名</label>
                            <div class="input-wrapper">
                                <i class="fas fa-user"></i>
                                <input v-model="resume.name" placeholder="请输入姓名">
                            </div>
                        </div>
                        <div class="form-col">
                            <label class="required">电话</label>
                            <div class="input-wrapper">
                                <i class="fas fa-phone-alt"></i>
                                <input v-model="resume.phone" placeholder="请输入电话号码">
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label class="required">邮箱</label>
                            <div class="input-wrapper">
                                <i class="fas fa-envelope"></i>
                                <input v-model="resume.email" placeholder="email@example.com">
                            </div>
                        </div>
                        <div class="form-col">
                            <label>性别</label>
                            <div class="input-wrapper select-wrapper no-icon">
                                <select v-model="resume.gender">
                                    <option value="" disabled selected>请选择性别</option>
                                    <option value="男">男</option>
                                    <option value="女">女</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label>年龄</label>
                            <div class="input-wrapper">
                                <i class="fas fa-id-card"></i>
                                <input v-model="resume.age" placeholder="例如: 23">
                            </div>
                        </div>
                        <div class="form-col">
                            <label>个人博客</label>
                            <div class="input-wrapper">
                                <i class="fas fa-link"></i>
                                <input v-model="resume.blog" placeholder="例如: https://yourblog.com">
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label>Github</label>
                            <div class="input-wrapper">
                                <i class="fab fa-github"></i>
                                <input v-model="resume.github" placeholder="例如: https://github.com/yourname">
                            </div>
                        </div>
                        <div class="form-col">
                            <label>求职意向</label>
                            <div class="input-wrapper">
                                <i class="fas fa-tag"></i>
                                <input v-model="resume.jobIntention" placeholder="例如: 前端工程师">
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label>政治面貌</label>
                            <div class="input-wrapper select-wrapper no-icon">
                                <select v-model="resume.politicalStatus">
                                    <option value="" disabled selected>请选择</option>
                                    <option value="中共党员">中共党员</option>
                                    <option value="共青团员">共青团员</option>
                                    <option value="群众">群众</option>
                                    <option value="其他">其他</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-col">
                            <label>地址</label>
                            <div class="input-wrapper">
                                <i class="fas fa-map-marker-alt"></i>
                                <input v-model="resume.location" placeholder="例如: 上海市">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Projects -->
                <div v-show="currentTab === 'projects'">
                    <div class="module-header"><i class="fas fa-project-diagram"></i> <span>项目经历</span></div>
                    <div class="module-desc">填写您参与的项目经历，包括项目名称、角色和具体贡献。可通过拖拽进行排序。</div>

                    <!-- List of Projects -->
                    <div v-for="(proj, index) in resume.projects" :key="index" class="edu-card">
                         <div class="edu-info">
                             <div class="edu-school" style="font-size: 16px;">{{ proj.name }}</div>
                             <div class="edu-tags">
                                 <div class="tag-blue"><i class="fas fa-user"></i> {{ proj.role }}</div>
                             </div>
                         </div>
                         <div class="edu-actions">
                             <div style="margin-right: 15px; color: #999;"><i class="far fa-calendar-alt"></i> {{ proj.duration }}</div>
                             <div class="action-btn edit" @click="editProject(index)"><i class="fas fa-pencil-alt"></i></div>
                             <div class="action-btn delete" @click="removeProject(index)"><i class="far fa-trash-alt"></i></div>
                         </div>
                    </div>

                    <!-- Separator / Add Header -->
                    <div style="margin-top: 30px; margin-bottom: 20px; border-top: 1px solid #eee; padding-top: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div class="form-title" style="font-size: 16px; font-weight: bold;">
                                {{ editingProjectIndex === -1 ? '添加项目经历' : '编辑项目经历' }}
                            </div>
                            <div style="color: #1890ff; cursor: pointer; font-size: 14px;" @click="resetProjectForm">
                                <i class="fas fa-plus"></i> 添加新的项目经历
                            </div>
                        </div>
                    </div>

                    <!-- Form -->
                    <div class="edit-form-card" style="border: none; padding: 0; box-shadow: none;">
                        <!-- Row 1: Name & Role -->
                        <div class="form-row">
                             <div class="form-col">
                                 <label class="required">项目名称</label>
                                 <div class="input-wrapper">
                                     <i class="fas fa-th-large"></i>
                                     <input v-model="currentProject.name" placeholder="例如：企业官网重构">
                                 </div>
                             </div>
                             <div class="form-col">
                                 <label class="required">担任角色</label>
                                 <div class="input-wrapper">
                                     <i class="fas fa-user"></i>
                                     <input v-model="currentProject.role" placeholder="例如：前端开发工程师">
                                 </div>
                             </div>
                        </div>
                        
                        <!-- Row 2: Time -->
                        <div class="form-row">
                            <div class="form-col">
                                <label class="required">项目时间</label>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div class="input-wrapper" style="flex: 1;">
                                        <input v-model="currentProject.startDate" placeholder="开始时间">
                                    </div>
                                    <span style="color: #999;">→</span>
                                    <div class="input-wrapper" style="flex: 1;">
                                        <input v-model="currentProject.endDate" placeholder="结束时间 (未结束可不选)">
                                        <i class="far fa-calendar-alt" style="left: auto; right: 10px;"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Row 3: Description -->
                        <div class="form-row">
                            <div class="form-col">
                                <label class="required">项目描述</label>
                                <div class="editor-container">
                                    <!-- Toolbar -->
                                    <div class="custom-editor-toolbar">
                                        <div class="toolbar-group">
                                            <div class="toolbar-btn" @click="insertText('**', '**', 'proj-desc', v => currentProject.description = v)" title="加粗"><i class="fas fa-bold"></i></div>
                                            <div class="toolbar-btn" @click="insertText('*', '*', 'proj-desc', v => currentProject.description = v)" title="斜体"><i class="fas fa-italic"></i></div>
                                        </div>
                                        <div class="toolbar-group">
                                            <div class="toolbar-btn" @click="insertText('- ', '', 'proj-desc', v => currentProject.description = v)" title="无序列表"><i class="fas fa-list-ul"></i></div>
                                            <div class="toolbar-btn" @click="insertText('1. ', '', 'proj-desc', v => currentProject.description = v)" title="有序列表"><i class="fas fa-list-ol"></i></div>
                                        </div>
                                        <div style="margin-left: auto; font-size: 12px; color: #999;">
                                            <i class="fab fa-markdown"></i> Markdown
                                        </div>
                                    </div>
                                    
                                    <!-- Textarea -->
                                    <textarea 
                                        id="proj-desc"
                                        class="custom-textarea" 
                                        style="min-height: 200px;"
                                        v-model="currentProject.description" 
                                        placeholder="- 实现了论坛系统，功能包含XXX、XXX..."
                                    ></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Add/Update Button -->
                        <button class="btn-save" @click="saveProjectItem" style="width: 100%; margin-top: 10px;">
                            <i class="fas fa-check"></i> {{ editingProjectIndex === -1 ? '确认添加' : '确认修改' }}
                        </button>
                    </div>
                </div>

                <!-- Awards -->
                <div v-if="currentTab === 'awards'" class="skills-wrapper">
                    <div class="module-header"><i class="fas fa-trophy"></i> <span>获奖经历</span></div>
                    <div class="module-desc">填写您的获奖经历，包括奖项名称、获奖时间和获奖级别。支持 Markdown 格式。</div>

                    <!-- Preview Card -->
                    <div class="skill-preview-card">
                        <div class="skill-preview-title">
                            <span><i class="far fa-star" style="margin-right: 5px; color: #1890ff;"></i> 获奖经历预览</span>
                        </div>
                        <div class="resume-desc" v-html="compiledAwards"></div>
                    </div>

                    <!-- Editor -->
                    <div style="margin-top: 20px;">
                        <div style="font-weight: bold; margin-bottom: 10px; color: #333;">
                            <span style="color: #ff4d4f;">*</span> <i class="far fa-lightbulb" style="color: #1890ff; margin-right: 5px;"></i> 获奖经历编辑
                        </div>
                        
                        <div class="editor-container">
                            <!-- Toolbar -->
                            <div class="custom-editor-toolbar">
                                <div class="toolbar-group">
                                    <div class="toolbar-btn" @click="insertText('**', '**', 'award-textarea', v => resume.awards = v)" title="加粗"><i class="fas fa-bold"></i></div>
                                    <div class="toolbar-btn" @click="insertText('*', '*', 'award-textarea', v => resume.awards = v)" title="斜体"><i class="fas fa-italic"></i></div>
                                </div>
                                <div class="toolbar-group">
                                    <div class="toolbar-btn" @click="insertText('- ', '', 'award-textarea', v => resume.awards = v)" title="无序列表"><i class="fas fa-list-ul"></i></div>
                                    <div class="toolbar-btn" @click="insertText('1. ', '', 'award-textarea', v => resume.awards = v)" title="有序列表"><i class="fas fa-list-ol"></i></div>
                                </div>
                            </div>
                            
                            <!-- Textarea -->
                            <textarea 
                                id="award-textarea" 
                                class="custom-textarea" 
                                v-model="resume.awards" 
                                placeholder="- 蓝桥杯C/C++国家三等奖&#10;- ACM区域赛铜牌..."
                            ></textarea>
                        </div>
                    </div>
                </div>

                <!-- Personal Summary -->
                <div v-if="currentTab === 'summary'" class="skills-wrapper">
                    <div class="module-header"><i class="far fa-file-alt"></i> <span>个人评价</span></div>
                    <div class="module-desc">填写您的个人特点、职业目标和核心竞争力，突出您的优势和特长。支持 Markdown 格式。</div>

                    <!-- Preview Card -->
                    <div class="skill-preview-card">
                        <div class="skill-preview-title">
                            <span><i class="far fa-star" style="margin-right: 5px; color: #1890ff;"></i> 个人评价预览</span>
                        </div>
                        <div class="resume-desc" v-html="compiledPersonalSummary"></div>
                    </div>

                    <!-- Editor -->
                    <div style="margin-top: 20px;">
                        <div style="font-weight: bold; margin-bottom: 10px; color: #333;">
                            <span style="color: #ff4d4f;">*</span> <i class="fas fa-pencil-alt" style="color: #1890ff; margin-right: 5px;"></i> 编辑个人评价
                        </div>
                        
                        <div class="editor-container">
                            <!-- Toolbar -->
                            <div class="custom-editor-toolbar">
                                <div class="toolbar-group">
                                    <div class="toolbar-btn" @click="insertText('**', '**', 'summary-textarea', v => resume.personalSummary = v)" title="加粗"><i class="fas fa-bold"></i></div>
                                    <div class="toolbar-btn" @click="insertText('*', '*', 'summary-textarea', v => resume.personalSummary = v)" title="斜体"><i class="fas fa-italic"></i></div>
                                </div>
                                <div class="toolbar-group">
                                    <div class="toolbar-btn" @click="insertText('- ', '', 'summary-textarea', v => resume.personalSummary = v)" title="无序列表"><i class="fas fa-list-ul"></i></div>
                                    <div class="toolbar-btn" @click="insertText('1. ', '', 'summary-textarea', v => resume.personalSummary = v)" title="有序列表"><i class="fas fa-list-ol"></i></div>
                                </div>
                            </div>
                            
                            <!-- Textarea -->
                            <textarea 
                                id="summary-textarea" 
                                class="custom-textarea" 
                                v-model="resume.personalSummary" 
                                placeholder="* 有快速学习的能力&#10;* 对目前的工作有极大的兴趣&#10;* 英语流利"
                            ></textarea>
                        </div>
                    </div>
                </div>

                <!-- Research -->
                <div v-if="currentTab === 'research'" class="skills-wrapper">
                    <div class="module-header"><i class="fas fa-flask"></i> <span>科研成果</span></div>
                    <div class="module-desc">填写您的科研成果，包括发表的论文、专利、研究报告等。支持 Markdown 格式。</div>

                    <!-- Preview Card -->
                    <div class="skill-preview-card">
                        <div class="skill-preview-title">
                            <span><i class="far fa-star" style="margin-right: 5px; color: #1890ff;"></i> 科研成果预览</span>
                        </div>
                        <div class="resume-desc" v-html="compiledResearch"></div>
                    </div>

                    <!-- Editor -->
                    <div style="margin-top: 20px;">
                        <div style="font-weight: bold; margin-bottom: 10px; color: #333;">
                            <span style="color: #ff4d4f;">*</span> <i class="fas fa-search" style="color: #1890ff; margin-right: 5px;"></i> 编辑科研成果
                        </div>
                        
                        <div class="editor-container">
                            <!-- Toolbar -->
                            <div class="custom-editor-toolbar">
                                <div class="toolbar-group">
                                    <div class="toolbar-btn" @click="insertText('**', '**', 'research-textarea', v => resume.research = v)" title="加粗"><i class="fas fa-bold"></i></div>
                                    <div class="toolbar-btn" @click="insertText('*', '*', 'research-textarea', v => resume.research = v)" title="斜体"><i class="fas fa-italic"></i></div>
                                </div>
                                <div class="toolbar-group">
                                    <div class="toolbar-btn" @click="insertText('- ', '', 'research-textarea', v => resume.research = v)" title="无序列表"><i class="fas fa-list-ul"></i></div>
                                    <div class="toolbar-btn" @click="insertText('1. ', '', 'research-textarea', v => resume.research = v)" title="有序列表"><i class="fas fa-list-ol"></i></div>
                                </div>
                            </div>
                            
                            <!-- Textarea -->
                            <textarea 
                                id="research-textarea" 
                                class="custom-textarea" 
                                v-model="resume.research" 
                                placeholder="* 发表**XXX**论文&#10;* 发表**XXX**论文"
                            ></textarea>
                        </div>
                    </div>
                </div>

                <!-- Skills -->
                <div v-if="currentTab === 'skills'" class="skills-wrapper">
                    <!-- Preview Card -->
                    <div class="skill-preview-card">
                        <div class="skill-preview-title">
                            <span><i class="far fa-eye" style="margin-right: 5px; color: #1890ff;"></i> 实时预览</span>
                            <span style="font-weight: normal; font-size: 12px; color: #999;">支持 Markdown 语法</span>
                        </div>
                        <div class="resume-desc" v-html="compiledMarkdown"></div>
                    </div>

                    <!-- Editor -->
                    <div class="editor-container">
                        <!-- Toolbar -->
                        <div class="custom-editor-toolbar">
                            <div class="toolbar-group">
                                <div class="toolbar-btn" @click="insertText('**', '**', 'skill-textarea', v => resume.summary = v)" title="加粗"><i class="fas fa-bold"></i></div>
                                <div class="toolbar-btn" @click="insertText('*', '*', 'skill-textarea', v => resume.summary = v)" title="斜体"><i class="fas fa-italic"></i></div>
                            </div>
                            <div class="toolbar-group">
                                <div class="toolbar-btn" @click="insertText('- ', '', 'skill-textarea', v => resume.summary = v)" title="无序列表"><i class="fas fa-list-ul"></i></div>
                                <div class="toolbar-btn" @click="insertText('1. ', '', 'skill-textarea', v => resume.summary = v)" title="有序列表"><i class="fas fa-list-ol"></i></div>
                            </div>
                            <div style="margin-left: auto; font-size: 12px; color: #999;">
                                <i class="fab fa-markdown"></i> Markdown
                            </div>
                        </div>
                        
                        <!-- Textarea -->
                        <textarea 
                            id="skill-textarea" 
                            class="custom-textarea" 
                            v-model="resume.summary" 
                            placeholder="- 熟练掌握 Java、Python 等编程语言..."
                        ></textarea>
                    </div>
                </div>

                <!-- Experience -->
                <div v-show="currentTab === 'experience'">
                    <div class="module-header"><i class="fas fa-briefcase"></i> <span>实习经历</span></div>
                    <div class="module-desc">请填写您的相关实习经历，这将展示您的职业发展轨迹。</div>
                    
                    <div v-for="(job, index) in resume.experience" :key="index" style="margin-bottom: 20px; border: 1px solid #e8e8e8; padding: 20px; border-radius: 6px; background: #fff; box-shadow: 0 1px 2px rgba(0,0,0,0.02);">
                        <div class="form-row" style="margin-bottom: 15px;">
                            <div class="form-col" style="flex: 2;">
                                <div class="input-wrapper">
                                    <i class="far fa-building"></i>
                                    <input v-model="job.company" placeholder="例如：某科技公司">
                                </div>
                            </div>
                            <div class="form-col" style="flex: 1;">
                                <div class="input-wrapper">
                                    <i class="far fa-calendar-alt"></i>
                                    <input v-model="job.duration" placeholder="例如：2021.06 - 2022.08">
                                </div>
                            </div>
                        </div>
                        
                        <div class="input-wrapper" style="margin-bottom: 15px;">
                            <i class="far fa-id-card"></i>
                            <input v-model="job.position" placeholder="例如：高级前端工程师">
                        </div>
                        
                        <div class="editor-container" style="margin-bottom: 15px;">
                            <!-- Toolbar -->
                            <div class="custom-editor-toolbar">
                                <div class="toolbar-group">
                                    <div class="toolbar-btn" @click="insertText('**', '**', 'exp-desc-' + index, v => job.description = v)" title="加粗"><i class="fas fa-bold"></i></div>
                                    <div class="toolbar-btn" @click="insertText('*', '*', 'exp-desc-' + index, v => job.description = v)" title="斜体"><i class="fas fa-italic"></i></div>
                                </div>
                                <div class="toolbar-group">
                                    <div class="toolbar-btn" @click="insertText('- ', '', 'exp-desc-' + index, v => job.description = v)" title="无序列表"><i class="fas fa-list-ul"></i></div>
                                    <div class="toolbar-btn" @click="insertText('1. ', '', 'exp-desc-' + index, v => job.description = v)" title="有序列表"><i class="fas fa-list-ol"></i></div>
                                </div>
                                <div style="margin-left: auto; font-size: 12px; color: #999;">
                                    <i class="fab fa-markdown"></i> Markdown
                                </div>
                            </div>
                            
                            <!-- Textarea -->
                            <textarea 
                                :id="'exp-desc-' + index"
                                class="custom-textarea" 
                                style="min-height: 200px;"
                                v-model="job.description" 
                                placeholder="- 负责模块开发..."
                            ></textarea>
                        </div>
                        
                        <button class="btn-outline" @click="removeExperience(index)" style="width: 100%; border-color: #ff4d4f; color: #ff4d4f;">
                            <i class="far fa-trash-alt"></i> 删除此条经历
                        </button>
                    </div>
                    
                    <button class="btn-outline" @click="addExperience" style="width: 100%; border-style: dashed; color: #666; background: #f9f9f9;">
                        <i class="fas fa-plus"></i> 添加实习经历
                    </button>
                </div>

                <!-- Work Experience (New) -->
                <div v-show="currentTab === 'work'">
                    <div class="module-header"><i class="fas fa-chart-line"></i> <span>工作经历</span></div>
                    <div class="module-desc">填写您的工作经历，包括公司、职位和工作职责等。可通过拖拽进行排序。</div>
                    
                    <div v-for="(job, index) in resume.workExperience" :key="index" style="margin-bottom: 20px; border: 1px solid #e8e8e8; padding: 20px; border-radius: 6px; background: #fff; box-shadow: 0 1px 2px rgba(0,0,0,0.02);">
                        <div class="form-row" style="margin-bottom: 15px;">
                            <div class="form-col" style="flex: 2;">
                                <div class="input-wrapper">
                                    <i class="far fa-building"></i>
                                    <input v-model="job.company" placeholder="例如：某科技公司">
                                </div>
                            </div>
                            <div class="form-col" style="flex: 1;">
                                <div class="input-wrapper">
                                    <i class="far fa-calendar-alt"></i>
                                    <input v-model="job.duration" placeholder="例如：2021.06 - 2022.08">
                                </div>
                            </div>
                        </div>
                        
                        <div class="input-wrapper" style="margin-bottom: 15px;">
                            <i class="far fa-id-card"></i>
                            <input v-model="job.position" placeholder="例如：高级前端工程师">
                        </div>
                        
                        <div class="editor-container" style="margin-bottom: 15px;">
                            <!-- Toolbar -->
                            <div class="custom-editor-toolbar">
                                <div class="toolbar-group">
                                    <div class="toolbar-btn" @click="insertText('**', '**', 'work-desc-' + index, v => job.description = v)" title="加粗"><i class="fas fa-bold"></i></div>
                                    <div class="toolbar-btn" @click="insertText('*', '*', 'work-desc-' + index, v => job.description = v)" title="斜体"><i class="fas fa-italic"></i></div>
                                </div>
                                <div class="toolbar-group">
                                    <div class="toolbar-btn" @click="insertText('- ', '', 'work-desc-' + index, v => job.description = v)" title="无序列表"><i class="fas fa-list-ul"></i></div>
                                    <div class="toolbar-btn" @click="insertText('1. ', '', 'work-desc-' + index, v => job.description = v)" title="有序列表"><i class="fas fa-list-ol"></i></div>
                                </div>
                                <div style="margin-left: auto; font-size: 12px; color: #999;">
                                    <i class="fab fa-markdown"></i> Markdown
                                </div>
                            </div>
                            
                            <!-- Textarea -->
                            <textarea 
                                :id="'work-desc-' + index"
                                class="custom-textarea" 
                                style="min-height: 200px;"
                                v-model="job.description" 
                                placeholder="- 负责模块开发..."
                            ></textarea>
                        </div>
                        
                        <button class="btn-outline" @click="removeWorkExperience(index)" style="width: 100%; border-color: #ff4d4f; color: #ff4d4f;">
                            <i class="far fa-trash-alt"></i> 删除此条经历
                        </button>
                    </div>
                    
                    <button class="btn-outline" @click="addWorkExperience" style="width: 100%; border-style: dashed; color: #666; background: #f9f9f9;">
                        <i class="fas fa-plus"></i> 添加工作经历
                    </button>
                </div>

                <!-- Education -->
                <div v-show="currentTab === 'education'">
                    <div v-if="!editingEducation">
                        <div class="module-header"><i class="fas fa-graduation-cap"></i> <span>教育背景</span></div>
                        <div class="module-desc">填写您的教育背景信息，包括学校、专业、学位等。可通过拖拽进行排序。</div>

                        <div style="margin-bottom: 20px;">
                            <div class="module-header" style="font-size: 14px; margin-bottom: 10px;">
                                <i class="far fa-star" style="color: #999; font-size: 14px;"></i> 
                                <span style="font-size: 14px; font-weight: normal; color: #666;">教育背景列表</span>
                            </div>
                            
                            <div v-for="(edu, index) in resume.education" :key="index" class="edu-card">
                                <div class="edu-info">
                                    <div class="edu-school">{{ edu.school }}</div>
                                    <div class="edu-tags">
                                        <div class="tag-blue"><i class="far fa-file-alt"></i> {{ edu.major }}</div>
                                        <div class="tag-orange">{{ edu.degree }}</div>
                                    </div>
                                </div>
                                <div class="edu-actions">
                                    <div style="display: flex; align-items: center; gap: 5px;">
                                        <i class="far fa-calendar-alt"></i> {{ edu.year }}
                                    </div>
                                    <div class="action-btn edit" @click="editEducation(index)"><i class="fas fa-pencil-alt"></i></div>
                                    <div class="action-btn delete" @click="removeEducation(index)"><i class="far fa-trash-alt"></i></div>
                                </div>
                            </div>

                            <button class="btn-outline" @click="addNewEducation" style="width: 100%; border-style: dashed; color: #1890ff; border-color: #1890ff; background: #f0f7ff;">
                                <i class="fas fa-plus"></i> 添加新的教育背景
                            </button>
                        </div>
                    </div>

                    <!-- Editing Form -->
                    <div v-else class="edit-form-card">
                        <div class="form-header">
                            <div class="form-title">{{ isNewEducation ? '添加新的教育背景' : '编辑教育背景' }}</div>
                            <button class="btn-link" @click="cancelEditEducation">取消</button>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <label class="required">学校名称</label>
                                <div class="input-wrapper">
                                    <i class="fas fa-university"></i>
                                    <input v-model="currentEducation.school" placeholder="例如：华东师范大学">
                                </div>
                            </div>
                            <div class="form-col">
                                <label>学校层级</label>
                                <div class="input-wrapper">
                                    <i class="fas fa-award"></i>
                                    <input v-model="currentEducation.level" placeholder="例如：985">
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-col">
                                <label class="required">专业</label>
                                <div class="input-wrapper">
                                    <i class="far fa-file-alt"></i>
                                    <input v-model="currentEducation.major" placeholder="例如：计算机技术">
                                </div>
                            </div>
                            <div class="form-col">
                                <label class="required">学位</label>
                                <div class="input-wrapper select-wrapper no-icon">
                                    <select v-model="currentEducation.degree">
                                        <option value="" disabled selected>请选择</option>
                                        <option value="本科">本科</option>
                                        <option value="硕士">硕士</option>
                                        <option value="博士">博士</option>
                                        <option value="其他">其他</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-col">
                                <label>GPA</label>
                                <div class="input-wrapper">
                                    <i class="fas fa-trophy"></i>
                                    <input v-model="currentEducation.gpa" placeholder="例如：3.8/4.0">
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-col">
                                <label class="required">在校时间</label>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div class="input-wrapper" style="flex: 1;">
                                        <input v-model="currentEducation.startDate" placeholder="起始时间">
                                    </div>
                                    <span style="color: #999;">→</span>
                                    <div class="input-wrapper" style="flex: 1;">
                                        <input v-model="currentEducation.endDate" placeholder="结束时间 (在读可不选)">
                                        <i class="far fa-calendar-alt" style="left: auto; right: 10px;"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <button class="btn-save" @click="saveEducationItem" style="width: 100%; margin-top: 10px;">
                            <i class="fas fa-check"></i> 确认保存
                        </button>
                    </div>
                </div>
                <!-- Custom Modules Editor -->
                <template v-for="mod in allModules.filter(m => m.isCustom)" :key="mod.id">
                    <div v-if="currentTab === mod.id" class="skills-wrapper">
                        <div class="module-header"><i :class="mod.icon"></i> <span>{{ mod.name }}</span></div>
                        <div class="module-desc">您正在编辑自定义模块“{{ mod.name }}”。支持 Markdown 格式。</div>

                        <!-- Preview Card -->
                        <div class="skill-preview-card">
                            <div class="skill-preview-title">
                                <span><i class="far fa-star" style="margin-right: 5px; color: #1890ff;"></i> {{ mod.name }}预览</span>
                            </div>
                            <div class="resume-desc" v-html="renderMarkdown(resume[mod.id])"></div>
                        </div>

                        <!-- Editor -->
                        <div style="margin-top: 20px;">
                            <div style="font-weight: bold; margin-bottom: 10px; color: #333;">
                                <span style="color: #ff4d4f;">*</span> <i class="fas fa-edit" style="color: #1890ff; margin-right: 5px;"></i> 编辑内容
                            </div>
                            
                            <div class="editor-container">
                                <!-- Toolbar -->
                                <div class="custom-editor-toolbar">
                                    <div class="toolbar-group">
                                        <div class="toolbar-btn" @click="insertText('**', '**', 'custom-textarea-' + mod.id, v => resume[mod.id] = v)" title="加粗"><i class="fas fa-bold"></i></div>
                                        <div class="toolbar-btn" @click="insertText('*', '*', 'custom-textarea-' + mod.id, v => resume[mod.id] = v)" title="斜体"><i class="fas fa-italic"></i></div>
                                    </div>
                                    <div class="toolbar-group">
                                        <div class="toolbar-btn" @click="insertText('- ', '', 'custom-textarea-' + mod.id, v => resume[mod.id] = v)" title="无序列表"><i class="fas fa-list-ul"></i></div>
                                        <div class="toolbar-btn" @click="insertText('1. ', '', 'custom-textarea-' + mod.id, v => resume[mod.id] = v)" title="有序列表"><i class="fas fa-list-ol"></i></div>
                                    </div>
                                </div>
                                
                                <!-- Textarea -->
                                <textarea 
                                    :id="'custom-textarea-' + mod.id" 
                                    class="custom-textarea" 
                                    v-model="resume[mod.id]" 
                                    placeholder="请输入模块内容..."
                                ></textarea>
                            </div>
                        </div>
                    </div>
                </template>
            </div>

            <div class="editor-bottom">
                <div class="save-status">
                    <i class="fas fa-check-circle"></i> 
                    <span v-if="saveTime">已保存 · {{ saveTime }}</span>
                    <span v-else>尚未保存</span>
                </div>
                <button class="btn-save" @click="saveResume"><i class="fas fa-cloud-upload-alt"></i> 保存</button>
            </div>
        </div>

        <!-- Preview Panel -->
        <div class="preview-panel">
            <div class="preview-header">
                <div class="preview-title">简历预览</div>
                <div style="font-size: 13px; color: #666; cursor: pointer;" @click="showPagination = !showPagination">
                    分页视图 
                    <i class="fas" :class="showPagination ? 'fa-check-square' : 'fa-square'"></i>
                </div>
            </div>
            
            <div class="preview-scroll-area">
                <div class="resume-paper" id="resume-preview" :class="['template-' + globalConfig.template, { 'show-pagination': showPagination }]" :style="previewStyles">
                    <!-- Resume Header -->
                    <div class="resume-header">
                        <div style="display: flex; align-items: center; justify-content: center; flex-direction: column;">
                            <img v-if="resume.avatar" :src="resume.avatar" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin-bottom: 15px; transform: scale(var(--avatar-scale));">
                            <h1 style="margin: 0; font-size: var(--name-size);">{{ resume.name || '姓名' }}</h1>
                            <p style="margin: 10px 0; color: #666;">
                                <span v-if="resume.gender">{{ resume.gender }} | </span>
                                <span v-if="resume.age">{{ resume.age }}岁 | </span>
                                <span v-if="resume.location">{{ resume.location }} | </span>
                                <span v-if="resume.politicalStatus">{{ resume.politicalStatus }}</span>
                            </p>
                            <p style="margin: 5px 0; color: #666;">
                                <span v-if="resume.jobIntention">求职意向：{{ resume.jobIntention }} | </span>
                                {{ resume.phone }} | {{ resume.email }}
                            </p>
                            <p style="margin: 5px 0; color: var(--theme-color);" v-if="resume.blog || resume.github">
                                <span v-if="resume.blog"><i class="fas fa-link"></i> {{ resume.blog }} </span>
                                <span v-if="resume.github" style="margin-left: 10px;"><i class="fab fa-github"></i> {{ resume.github }}</span>
                            </p>
                        </div>
                    </div>

                    <!-- Dynamic Modules -->
                    <template v-for="mod in moduleOrder" :key="mod">
                        <!-- Work Experience -->
                        <div class="resume-section" v-if="mod === 'experience' && resume.experience.length > 0">
                            <h3>实习经历</h3>
                            <div v-for="job in resume.experience" class="resume-item">
                                <div class="resume-item-header">
                                    <span>{{ job.company }}</span>
                                    <span style="color: #666; font-weight: normal;">{{ job.duration }}</span>
                                </div>
                                <div class="resume-item-subtitle">{{ job.position }}</div>
                                <div class="resume-desc" v-html="renderMarkdown(job.description)"></div>
                            </div>
                        </div>

                        <!-- Work Experience -->
                        <div class="resume-section" v-if="mod === 'work' && resume.workExperience && resume.workExperience.length > 0">
                            <h3>工作经历</h3>
                            <div v-for="job in resume.workExperience" class="resume-item">
                                <div class="resume-item-header">
                                    <span>{{ job.company }}</span>
                                    <span style="color: #666; font-weight: normal;">{{ job.duration }}</span>
                                </div>
                                <div class="resume-item-subtitle">{{ job.position }}</div>
                                <div class="resume-desc" v-html="renderMarkdown(job.description)"></div>
                            </div>
                        </div>

                        <!-- Projects (New) -->
                        <div class="resume-section" v-if="mod === 'projects' && resume.projects && resume.projects.length > 0">
                            <h3>项目经历</h3>
                            <div v-for="proj in resume.projects" class="resume-item">
                                <div class="resume-item-header">
                                    <span>{{ proj.name }}</span>
                                    <span style="color: #666; font-weight: normal;">{{ proj.duration }}</span>
                                </div>
                                <div class="resume-item-subtitle">{{ proj.role }}</div>
                                <div class="resume-desc" v-html="renderMarkdown(proj.description)"></div>
                            </div>
                        </div>

                        <!-- Awards (New) -->
                        <div class="resume-section" v-if="mod === 'awards'">
                            <h3>获奖经历</h3>
                            <div class="resume-desc" v-html="compiledAwards"></div>
                        </div>

                        <!-- Personal Summary (New) -->
                        <div class="resume-section" v-if="mod === 'summary'">
                            <h3>个人评价</h3>
                            <div class="resume-desc" v-html="compiledPersonalSummary"></div>
                        </div>

                        <!-- Research (New) -->
                        <div class="resume-section" v-if="mod === 'research'">
                            <h3>科研成果</h3>
                            <div class="resume-desc" v-html="compiledResearch"></div>
                        </div>

                        <!-- Custom Modules (Dynamic) -->
                        <div class="resume-section" v-if="allModules.find(m => m.id === mod && m.isCustom)">
                            <h3>{{ allModules.find(m => m.id === mod).name }}</h3>
                            <div class="resume-desc" v-if="resume[mod]" v-html="renderMarkdown(resume[mod])"></div>
                            <div class="resume-desc" v-else style="color: #ccc; font-style: italic;">（暂无内容）</div>
                        </div>

                        <!-- Skills -->
                        <div class="resume-section" v-if="mod === 'skills' && resume.summary">
                            <h3>专业技能</h3>
                            <div class="resume-desc" v-html="compiledMarkdown"></div>
                        </div>

                        <!-- Education -->
                        <div class="resume-section" v-if="mod === 'education' && resume.education.length > 0">
                            <h3>教育背景</h3>
                            <div v-for="edu in resume.education" class="resume-item">
                                <div class="resume-item-header">
                                    <span>{{ edu.school }}</span>
                                    <span style="color: #666; font-weight: normal;">{{ edu.year }}</span>
                                </div>
                                <div class="resume-item-subtitle">
                                    {{ edu.degree }} 
                                    <span v-if="edu.major" style="margin-left: 10px; color: #666;">| {{ edu.major }}</span>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <div class="preview-bottom">
                <button class="btn-outline"><i class="fas fa-pencil-alt"></i> 修改简历</button>
                <button class="btn-export" :disabled="isDownloading" @click="downloadPDF">
                    <i class="fas fa-download"></i> {{ isDownloading ? '生成中...' : '导出 PDF' }}
                </button>
            </div>
        </div>

        <!-- Add Module Modal -->
        <div class="centered-modal-overlay" :class="{ active: showAddModuleModal }" @click.self="showAddModuleModal = false">
            <div class="centered-modal-card">
                <div class="centered-modal-header">
                    <div class="centered-modal-title"><i class="fas fa-plus"></i> 添加自定义模块</div>
                    <i class="fas fa-times" style="cursor: pointer; color: #999; font-size: 18px;" @click="showAddModuleModal = false"></i>
                </div>
                
                <div class="centered-modal-body">
                    <div class="info-box">
                        <div class="info-box-title"><i class="far fa-question-circle"></i> 使用说明</div>
                        <ul>
                            <li>自定义模块可以添加简历中未包含的其他信息</li>
                            <li>添加后可以在左侧模块列表中查看和编辑</li>
                            <li>可以通过拖拽调整模块在简历中的显示顺序</li>
                        </ul>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label class="required" style="display: flex; align-items: center; gap: 5px;">
                            <i class="fas fa-pen" style="color: #1890ff; font-size: 12px;"></i> 模块标题 <i class="far fa-question-circle" style="color: #999; font-weight: normal;"></i>
                        </label>
                        <div class="input-wrapper">
                            <input v-model="newModuleTitle" placeholder="请输入模块标题" style="padding-left: 15px;">
                        </div>
                    </div>
                </div>

                <div class="centered-modal-footer">
                    <button class="btn-outline" @click="showAddModuleModal = false">取消</button>
                    <button class="btn-save" @click="addNewModule" style="display: flex; align-items: center; gap: 5px;">
                        <i class="fas fa-plus"></i> 添加模块
                    </button>
                </div>
            </div>
        </div>

        <!-- Config Modal (Moved inside #app) -->
        <div class="modal-overlay" :class="{ active: showConfigModal }" @click.self="showConfigModal = false">
            <div class="modal-card">
                <div class="modal-header">
                    <div class="modal-title"><i class="fas fa-pen"></i> 简历配置与模块管理</div>
                    <i class="fas fa-times" style="position: absolute; right: 25px; top: 25px; cursor: pointer; color: #999; font-size: 18px;" @click="showConfigModal = false"></i>
                </div>
                
                <div class="config-tabs">
                    <div class="config-tab" :class="{ active: currentConfigTab === 'global' }" @click="currentConfigTab = 'global'">全局配置</div>
                    <div class="config-tab" :class="{ active: currentConfigTab === 'module' }" @click="currentConfigTab = 'module'">模块配置</div>
                    <div class="config-tab" :class="{ active: currentConfigTab === 'basic' }" @click="currentConfigTab = 'basic'">基本信息</div>
                </div>

                <div class="modal-body">
                    <!-- Global Config -->
                    <div v-if="currentConfigTab === 'global'" style="padding: 10px;">
                        <div class="config-item">
                            <div class="config-label">
                                <i class="fas fa-th-large"></i> <span style="color: #ff4d4f; margin-right: 4px;">*</span> 选择简历模版 <i class="far fa-question-circle info-icon"></i>
                            </div>
                            <div class="input-wrapper select-wrapper">
                                <select v-model="globalConfig.template">
                                    <option value="modern">现代</option>
                                    <option value="classic">经典</option>
                                    <option value="simple">简约</option>
                                </select>
                            </div>
                        </div>

                        <div class="config-item">
                            <div class="config-label">
                                <i class="fas fa-palette"></i> 主题色 <i class="far fa-question-circle info-icon"></i>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <div class="color-swatch" style="background: #1890ff;" @click="globalConfig.themeColor = '#1890ff'" :style="{ borderColor: globalConfig.themeColor === '#1890ff' ? '#000' : '#ddd' }"></div>
                                <div class="color-swatch" style="background: #52c41a;" @click="globalConfig.themeColor = '#52c41a'" :style="{ borderColor: globalConfig.themeColor === '#52c41a' ? '#000' : '#ddd' }"></div>
                                <div class="color-swatch" style="background: #fa8c16;" @click="globalConfig.themeColor = '#fa8c16'" :style="{ borderColor: globalConfig.themeColor === '#fa8c16' ? '#000' : '#ddd' }"></div>
                                <div class="color-swatch" style="background: #2f54eb;" @click="globalConfig.themeColor = '#2f54eb'" :style="{ borderColor: globalConfig.themeColor === '#2f54eb' ? '#000' : '#ddd' }"></div>
                                <div class="color-swatch" style="background: #722ed1;" @click="globalConfig.themeColor = '#722ed1'" :style="{ borderColor: globalConfig.themeColor === '#722ed1' ? '#000' : '#ddd' }"></div>
                            </div>
                        </div>

                        <div class="config-item">
                            <div class="config-label">
                                <i class="fas fa-text-height"></i> 模块标题大小 <i class="far fa-question-circle info-icon"></i>
                            </div>
                            <div class="input-wrapper select-wrapper">
                                <select v-model="globalConfig.headingSize">
                                    <option value="14px">14px</option>
                                    <option value="16px">16px</option>
                                    <option value="18px">18px</option>
                                </select>
                            </div>
                        </div>

                        <div class="config-item">
                            <div class="config-label">
                                <i class="fas fa-font"></i> 模块内容大小 <i class="far fa-question-circle info-icon"></i>
                            </div>
                            <div class="input-wrapper select-wrapper">
                                <select v-model="globalConfig.contentSize">
                                    <option value="12px">12px</option>
                                    <option value="13px">13px</option>
                                    <option value="14px">14px</option>
                                </select>
                            </div>
                        </div>

                        <div class="config-item">
                            <div class="config-label">
                                <i class="far fa-square"></i> 模块间距 (px) <i class="far fa-question-circle info-icon"></i>
                            </div>
                            <div class="input-wrapper" style="width: 100px;">
                                <input type="number" v-model="globalConfig.moduleSpacing">
                            </div>
                        </div>

                        <div class="config-item">
                            <div class="config-label">
                                <i class="fas fa-arrows-alt-v"></i> 行高 <i class="far fa-question-circle info-icon"></i>
                            </div>
                            <div class="input-wrapper" style="width: 100px;">
                                <input type="number" step="0.1" v-model="globalConfig.lineHeight">
                            </div>
                        </div>
                    </div>

                    <!-- Module Config -->
                    <div v-else-if="currentConfigTab === 'module'">
                        <div style="color: #666; margin-bottom: 15px; display: flex; align-items: center; gap: 5px;">
                            <i class="far fa-question-circle"></i> 模块配置 (拖拽调整顺序，点击切换显示/隐藏)
                        </div>

                        <div class="module-list-enhanced">
                             <div 
                                 v-for="(mod, index) in allModules" 
                                 :key="mod.id" 
                                 class="module-item-enhanced"
                                 :class="{ 'dragging': draggedIndex === index, 'drag-over': dragOverIndex === index }"
                                 :draggable="!mod.locked"
                                 @dragstart="onDragStart($event, index)"
                                 @dragenter="onDragEnter($event, index)"
                                 @dragover.prevent
                                 @drop="onDrop($event, index)"
                                 @dragend="onDragEnd"
                             >
                                 <div class="module-info">
                                     <i class="fas fa-bars drag-handle" :style="{ cursor: mod.locked ? 'not-allowed' : 'grab', opacity: mod.locked ? 0.3 : 1 }"></i>
                                     <div class="module-icon"><i :class="mod.icon"></i></div>
                                     <div style="font-weight: bold; color: #333;">{{ mod.name }}</div>
                                 </div>
                                 <div class="module-toggle" :class="mod.visible ? 'active' : 'inactive'" @click="toggleModuleVisibility(index)">
                                     <!-- Checkbox -->
                                     <div class="checkbox-wrapper">
                                         <i class="fas fa-check" v-if="mod.visible"></i>
                                     </div>
                                     
                                     <!-- Eye Icon -->
                                     <i class="fas eye-icon" :class="mod.visible ? 'fa-eye' : 'fa-eye-slash'"></i>
                                     
                                     <!-- Text -->
                                     <span :style="{ color: mod.visible ? '#52c41a' : '#999' }">{{ mod.visible ? '显示' : '隐藏' }}</span>
                                 </div>
                             </div>
                        </div>
                    </div>

                    <!-- Basic Info Config -->
                    <div v-else-if="currentConfigTab === 'basic'" style="padding: 10px;">
                        <div class="config-item">
                            <div class="config-label">
                                <span style="font-weight: normal; font-family: serif; font-size: 16px;">Tr</span> 姓名字体大小 <i class="far fa-question-circle info-icon"></i>
                            </div>
                            <div class="input-wrapper select-wrapper">
                                <select v-model="globalConfig.nameSize">
                                    <option value="18px">18px</option>
                                    <option value="20px">20px</option>
                                    <option value="22px">22px</option>
                                    <option value="24px">24px</option>
                                    <option value="26px">26px</option>
                                </select>
                            </div>
                        </div>

                        <div class="config-item">
                            <div class="config-label">
                                <i class="far fa-user"></i> 头像缩放倍率 <i class="far fa-question-circle info-icon"></i>
                            </div>
                            <div class="input-wrapper select-wrapper">
                                <select v-model="globalConfig.avatarScale">
                                    <option value="0.8">0.8</option>
                                    <option value="0.9">0.9</option>
                                    <option value="1">1</option>
                                    <option value="1.1">1.1</option>
                                    <option value="1.2">1.2</option>
                                    <option value="1.3">1.3</option>
                                </select>
                            </div>
                        </div>
                    </div>

                 <!-- Placeholder for other modules -->
                 <div v-else style="padding: 40px; text-align: center; color: #999;">
                     <i class="fas fa-tools" style="font-size: 24px; margin-bottom: 10px;"></i>
                     <div style="font-size: 14px;">该模块暂无更多高级配置项</div>
                 </div>
                </div>

                <div class="modal-footer">
                    <button class="btn-save" @click="saveConfig" style="width: 120px;">完成配置</button>
                    <button class="btn-save" @click="saveResume" style="margin-left: 10px; background: white; color: #1890ff; border: 1px solid #1890ff;">
                        <i class="fas fa-cloud-upload-alt"></i> 保存
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted, onUpdated, computed, nextTick, watch } = Vue

        createApp({
            setup() {
                const isDownloading = ref(false)
                const showPagination = ref(true)
                const currentTab = ref('basic')
                const saveTime = ref('')
                const resume = ref({
                    name: '你的姓名',
                    title: '你的职位',
                    email: 'your.email@example.com',
                    phone: '138xxxxxxxx',
                    gender: '男',
                    age: '24',
                    blog: '',
                    github: '',
                    jobIntention: '前端开发工程师',
                    politicalStatus: '群众',
                    location: '上海市',
                    avatar: '', 
                    summary: '- 熟练掌握 JavaScript、HTML、CSS 等前端技术。\n- 熟悉 Vue.js / React 等主流框架。\n- 具备良好的代码规范和团队协作能力。',
                    awards: '- 某某奖项一等奖\n- 某某奖项二等奖',
                    personalSummary: '- 热爱编程，对新技术保持敏感。\n- 具备较强的学习能力和解决问题的能力。\n- 善于沟通，能够快速融入团队。',
                    research: '',
                    experience: [
                        { company: '某某科技公司', position: '前端开发实习生', duration: '2023.06 - 2023.09', description: '- 负责公司官网的前端开发与维护。\n- 参与内部管理系统的功能迭代。' }
                    ],
                    workExperience: [],
                    projects: [
                        { name: '某某项目', role: '核心开发', duration: '2023.10 - 2023.12', description: '- 这是一个基于 Vue3 的电商项目。\n- 我负责了商品详情页、购物车等核心模块的开发。\n- 使用了 Pinia 进行状态管理。' }
                    ],
                    education: [
                        { school: '某某大学', degree: '本科', major: '计算机科学与技术', year: '2020.09 - 2024.06', level: '' }
                    ]
                })

                // 通用 Markdown 渲染函数
                const renderMarkdown = (text) => {
                    if (!text) return '';
                    if (typeof marked !== 'undefined') {
                        return marked.parse(text);
                    }
                    return text.replace(/\n/g, '<br>').replace(/- /g, '• ');
                }

                // 简单的 Markdown 渲染 (保留 computed 以兼容旧代码，或直接在模板中使用 renderMarkdown)
                const compiledMarkdown = computed(() => {
                    if (!resume.value.summary) return '<p style="color:#999">暂无内容，请在下方编辑...</p>';
                    return renderMarkdown(resume.value.summary);
                })

                const compiledAwards = computed(() => {
                    if (!resume.value.awards) return '<p style="color:#999">暂无内容，请在下方编辑...</p>';
                    return renderMarkdown(resume.value.awards);
                })

                const compiledPersonalSummary = computed(() => {
                    if (!resume.value.personalSummary) return '<span style="color:#ccc; font-style: italic;">尚未填写个人评价</span>';
                    return renderMarkdown(resume.value.personalSummary);
                })

                const compiledResearch = computed(() => {
                    if (!resume.value.research) return '<span style="color:#ccc; font-style: italic;">尚未填写科研成果</span>';
                    return renderMarkdown(resume.value.research);
                })

                const previewStyles = computed(() => {
                    return {
                        '--theme-color': globalConfig.value.themeColor,
                        '--heading-size': globalConfig.value.headingSize,
                        '--content-size': globalConfig.value.contentSize,
                        '--module-spacing': globalConfig.value.moduleSpacing + 'px',
                        '--line-height': globalConfig.value.lineHeight,
                        '--name-size': globalConfig.value.nameSize,
                        '--avatar-scale': globalConfig.value.avatarScale,
                        'font-family': globalConfig.value.template === 'classic' ? '"Times New Roman", Times, serif' : "'Helvetica Neue', Arial, sans-serif"
                    }
                })

                // 通用插入文本函数
                const insertText = (prefix, suffix, elementId, updateModel) => {
                    const textarea = document.getElementById(elementId);
                    if (!textarea) return;

                    const start = textarea.selectionStart;
                    const end = textarea.selectionEnd;
                    const text = textarea.value;
                    
                    const before = text.substring(0, start);
                    const selection = text.substring(start, end);
                    const after = text.substring(end);

                    const newValue = before + prefix + selection + suffix + after;
                    
                    // 更新模型
                    updateModel(newValue);
                    
                    // 恢复焦点并移动光标
                    setTimeout(() => {
                        textarea.focus();
                        textarea.selectionStart = start + prefix.length;
                        textarea.selectionEnd = end + prefix.length;
                    }, 0);
                }

                const triggerUpload = () => {
                    document.getElementById('avatar-upload').click();
                }

                const handleAvatarUpload = (event) => {
                    const file = event.target.files[0];
                    if (file) {
                        if (file.size > 1024 * 1024) {
                            alert('图片大小不能超过 1MB');
                            return;
                        }
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            resume.value.avatar = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    }
                }

                const removeAvatar = () => {
                    resume.value.avatar = '';
                }

                const addExperience = () => {
                    resume.value.experience.push({ company: '', position: '', duration: '', description: '' })
                }

                const removeExperience = (index) => {
                    resume.value.experience.splice(index, 1)
                }

                const addWorkExperience = () => {
                    if (!resume.value.workExperience) resume.value.workExperience = [];
                    resume.value.workExperience.push({ company: '', position: '', duration: '', description: '' })
                }

                const removeWorkExperience = (index) => {
                    resume.value.workExperience.splice(index, 1)
                }

                const editingProjectIndex = ref(-1)
                const currentProject = ref({ name: '', role: '', startDate: '', endDate: '', description: '' })

                const resetProjectForm = () => {
                    editingProjectIndex.value = -1
                    currentProject.value = { name: '', role: '', startDate: '', endDate: '', description: '' }
                }

                const editProject = (index) => {
                    editingProjectIndex.value = index
                    const proj = { ...resume.value.projects[index] }
                    let start = '', end = ''
                    if (proj.duration) {
                        const parts = proj.duration.split(' - ')
                        start = parts[0] || ''
                        end = parts[1] === '至今' ? '' : (parts[1] || '')
                    }
                    currentProject.value = { ...proj, startDate: start, endDate: end }
                    
                    // 滚动到表单位置
                    setTimeout(() => {
                         const form = document.querySelector('.edit-form-card')
                         if(form) form.scrollIntoView({ behavior: 'smooth' })
                    }, 100)
                }

                const removeProject = (index) => {
                    if(confirm('确定要删除这条项目经历吗？')) {
                        resume.value.projects.splice(index, 1)
                    }
                }

                const saveProjectItem = () => {
                    if (!currentProject.value.name) {
                        alert('请输入项目名称');
                        return;
                    }
                    
                    // 组合时间
                    let duration = currentProject.value.startDate
                    if (currentProject.value.endDate) {
                        duration += ' - ' + currentProject.value.endDate
                    } else if (currentProject.value.startDate) {
                         duration += ' - 至今'
                    }
                    
                    const newItem = {
                        ...currentProject.value,
                        duration: duration
                    }
                    
                    if (editingProjectIndex.value === -1) {
                        if (!resume.value.projects) resume.value.projects = []
                        resume.value.projects.push(newItem)
                    } else {
                        resume.value.projects[editingProjectIndex.value] = newItem
                    }
                    
                    resetProjectForm()
                }

                const editingEducation = ref(false)
                const isNewEducation = ref(false)
                const currentEducationIndex = ref(-1)
                const currentEducation = ref({})
                
                // 模块配置升级
                const showConfigModal = ref(false)
                const showAddModuleModal = ref(false)
                const newModuleTitle = ref('')
                const currentConfigTab = ref('global')
                const globalConfig = ref({
                    template: 'modern',
                    themeColor: '#1890ff',
                    headingSize: '16px',
                    contentSize: '14px',
                    moduleSpacing: 24,
                    lineHeight: 1.5,
                    nameSize: '24px',
                    avatarScale: '1'
                })
                
                // 定义所有可用模块及其元数据
                const allModules = ref([
                    { id: 'basic', name: '基本信息', icon: 'fas fa-user', visible: true, locked: true }, // 锁定不可隐藏
                    { id: 'education', name: '教育背景', icon: 'fas fa-graduation-cap', visible: true },
                    { id: 'experience', name: '实习经历', icon: 'fas fa-briefcase', visible: true },
                    { id: 'work', name: '工作经历', icon: 'fas fa-chart-line', visible: true },
                    { id: 'projects', name: '项目经历', icon: 'fas fa-project-diagram', visible: true },
                    { id: 'skills', name: '专业技能', icon: 'fas fa-check-square', visible: true },
                    { id: 'awards', name: '获奖经历', icon: 'fas fa-trophy', visible: true },
                    { id: 'summary', name: '个人评价', icon: 'fas fa-user-edit', visible: true },
                    { id: 'research', name: '科研成果', icon: 'fas fa-flask', visible: true }
                ])
                
                const addNewModule = () => {
                    if (!newModuleTitle.value.trim()) {
                        alert('请输入模块标题');
                        return;
                    }
                    
                    const newId = 'custom_' + Date.now();
                    const newModule = { 
                        id: newId, 
                        name: newModuleTitle.value, 
                        icon: 'fas fa-pen-square', // Default icon for custom modules
                        visible: true,
                        isCustom: true // Mark as custom
                    };
                    
                    // Add to module list
                    allModules.value.push(newModule);
                    
                    // Initialize data storage for this module
                    // We'll store it in a generic 'customModules' object in resume if needed, 
                    // or just dynamic property on resume object
                    resume.value[newId] = ''; 
                    
                    newModuleTitle.value = '';
                    showAddModuleModal.value = false;
                    
                    // Switch to the new tab
                    currentTab.value = newId;
                }

                // 计算当前显示的模块顺序（不包括基本信息，因为基本信息位置固定）
                const moduleOrder = computed(() => {
                    return allModules.value
                        .filter(m => m.visible && m.id !== 'basic')
                        .map(m => m.id)
                })

                const openConfigModal = () => {
                    showConfigModal.value = true
                }
                
                const toggleModuleVisibility = (index) => {
                    if (allModules.value[index].locked) return; // 锁定的模块不可切换
                    allModules.value[index].visible = !allModules.value[index].visible;
                }

                // 简单的数组移动函数（后续可接入拖拽库）
                const draggedIndex = ref(-1)
                const dragOverIndex = ref(-1)

                const onDragStart = (event, index) => {
                    if (allModules.value[index].locked) {
                        event.preventDefault();
                        return;
                    }
                    draggedIndex.value = index;
                    event.dataTransfer.effectAllowed = 'move';
                    // 稍微延迟添加 dragging 类，避免拖拽时原元素立即消失
                    setTimeout(() => {
                        event.target.classList.add('dragging');
                    }, 0);
                }

                const onDragEnter = (event, index) => {
                    // 如果目标是锁定的（如基本信息），不允许放置在其上方（保持其在第一位）
                    // 但如果是为了交换其他位置，可以允许经过
                    if (index !== draggedIndex.value) {
                        dragOverIndex.value = index;
                    }
                }

                const onDragEnd = (event) => {
                    draggedIndex.value = -1;
                    dragOverIndex.value = -1;
                    event.target.classList.remove('dragging');
                }

                const onDrop = (event, index) => {
                    const fromIndex = draggedIndex.value;
                    const toIndex = index;
                    
                    if (fromIndex === -1 || fromIndex === toIndex) return;
                    
                    // 再次检查锁定状态，防止绕过
                    if (allModules.value[toIndex].locked) {
                         // 如果试图放置在锁定项（如基本信息）上，且该锁定项在列表顶部，
                         // 我们应该允许放置在其下方（即 index 1）而不是替换它
                         // 这里简化逻辑：如果目标是锁定的，不做任何操作，或者根据需要调整
                         // 策略：锁定项永远在 index 0，不可移动，不可被抢占
                         return;
                    }

                    // 移动元素
                    const item = allModules.value[fromIndex];
                    allModules.value.splice(fromIndex, 1);
                    allModules.value.splice(toIndex, 0, item);
                }

                const moveModule = (index, direction) => {
                   // 兼容旧的按钮排序（如果需要）
                   if (index + direction < 0 || index + direction >= allModules.value.length) return
                   const temp = allModules.value[index]
                   allModules.value[index] = allModules.value[index + direction]
                   allModules.value[index + direction] = temp
                }

                const saveConfig = () => {
                    showConfigModal.value = false
                    saveResume() 
                }

                const addNewEducation = () => {
                    editingEducation.value = true
                    isNewEducation.value = true
                    currentEducation.value = { school: '', major: '', degree: '', level: '', gpa: '', startDate: '', endDate: '', year: '' }
                }

                const editEducation = (index) => {
                    editingEducation.value = true
                    isNewEducation.value = false
                    currentEducationIndex.value = index
                    // 分割 year 字段（如果有的话）
                    const edu = { ...resume.value.education[index] }
                    if (edu.year && edu.year.includes('-')) {
                        const parts = edu.year.split(' - ')
                        edu.startDate = parts[0]
                        edu.endDate = parts[1] === '至今' ? '' : parts[1]
                    } else {
                         edu.startDate = edu.year
                    }
                    currentEducation.value = edu
                }

                const cancelEditEducation = () => {
                    editingEducation.value = false
                }

                const saveEducationItem = () => {
                    // 合并时间
                    let yearStr = currentEducation.value.startDate
                    if (currentEducation.value.endDate) {
                        yearStr += ' - ' + currentEducation.value.endDate
                    } else if (currentEducation.value.startDate) {
                         yearStr += ' - 至今'
                    }
                    currentEducation.value.year = yearStr

                    if (isNewEducation.value) {
                        resume.value.education.push({ ...currentEducation.value })
                    } else {
                        resume.value.education[currentEducationIndex.value] = { ...currentEducation.value }
                    }
                    editingEducation.value = false
                }

                const removeEducation = (index) => {
                    if(confirm('确定要删除这条教育背景吗？')) {
                        resume.value.education.splice(index, 1)
                    }
                }

                const saveResume = () => {
                    const data = {
                        resume: resume.value,
                        // 保存所有模块的完整状态（包括顺序和可见性）
                        allModules: allModules.value,
                        // 保存全局配置
                        globalConfig: globalConfig.value
                    }
                    localStorage.setItem('my_resume', JSON.stringify(data))
                    saveTime.value = new Date().toLocaleString()
                    alert('简历已保存到本地！')
                }

                const downloadPDF = () => {
                    isDownloading.value = true;
                    
                    // 再次检查组件是否加载
                    if (typeof html2pdf === 'undefined') {
                         if (window.html2pdf) {
                             window.html2pdf = window.html2pdf;
                         } else {
                            alert('PDF 生成组件未能加载。请检查网络连接或刷新页面。');
                            isDownloading.value = false;
                            return;
                         }
                    }

                    // 添加导出状态类，改变页面布局
                    document.body.classList.add('exporting');
                    
                    // 强制滚动到顶部
                    window.scrollTo(0, 0);

                    // 获取预览元素
                    const element = document.getElementById('resume-preview');
                    
                    // 临时移除高度限制，避免 GAP 高度导致的多余空白页
                    const originalMinHeight = element.style.minHeight;
                    element.style.minHeight = 'initial';
                    
                    const opt = {
                        margin:       0, // 页面样式中已包含 padding
                        filename:     (resume.value.name || '简历') + '.pdf',
                        image:        { type: 'jpeg', quality: 0.98 },
                        html2canvas:  { 
                            scale: 2, 
                            useCORS: true, 
                            scrollY: 0 
                        },
                        jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' },
                        pagebreak:    { mode: ['css', 'legacy'] }
                    };
                    
                    // 延迟执行以等待样式应用和重绘
                    setTimeout(() => {
                        html2pdf().set(opt).from(element).save()
                            .then(() => {
                                document.body.classList.remove('exporting');
                                element.style.minHeight = originalMinHeight; // 恢复高度
                                isDownloading.value = false;
                            })
                            .catch(err => {
                                console.error(err);
                                document.body.classList.remove('exporting');
                                element.style.minHeight = originalMinHeight; // 恢复高度
                                alert('PDF 生成失败：' + err.message);
                                isDownloading.value = false;
                            });
                    }, 500);
                }

                onMounted(() => {
                    const saved = localStorage.getItem('my_resume')
                    if (saved) {
                        try {
                            const parsed = JSON.parse(saved)
                            // 兼容旧版本数据
                            if (parsed.resume) {
                                resume.value = parsed.resume
                                if (parsed.allModules) {
                                    // 过滤掉已废弃的 scores 模块
                                    allModules.value = parsed.allModules.filter(m => m.id !== 'scores')
                                } else if (parsed.moduleOrder) {
                                    // 迁移逻辑：如果只有旧的 moduleOrder，尝试恢复到 allModules
                                    // 这里简单处理，主要依赖默认值
                                }
                                
                                if (parsed.globalConfig) {
                                    globalConfig.value = { ...globalConfig.value, ...parsed.globalConfig }
                                }
                            } else {
                                resume.value = parsed
                            }
                        } catch(e) {}
                    }
                    
                    // Initial pagination calc
                    setTimeout(calculatePagination, 1000);
                })

                onUpdated(() => {
                    // Re-calculate on update (debounced?)
                    // For now, simple nextTick
                    nextTick(() => {
                        calculatePagination()
                    })
                })
                
                watch(showPagination, () => {
                    nextTick(calculatePagination)
                })

                const calculatePagination = () => {
                    const paper = document.getElementById('resume-preview');
                    if (!paper) return;

                    // If downloading, preserve the current pagination state (don't clear it!)
                    // html2pdf needs the .new-page-start classes to know where to break.
                    if (isDownloading.value) return;

                    if (!showPagination.value) {
                        // Clear all pagination
                        const splitters = paper.querySelectorAll('.new-page-start');
                        splitters.forEach(el => {
                            el.classList.remove('new-page-start');
                            el.style.marginTop = '';
                            el.removeAttribute('data-page-num');
                            el.removeAttribute('data-total-pages');
                        });
                        
                        // Reset visual styles
                        paper.style.backgroundImage = '';
                        paper.style.minHeight = '';
                        paper.style.backgroundColor = ''; 
                        return;
                    }

                    const reference = document.getElementById('a4-reference');
                    if (!reference) return;

                    // 1. Reset
                    const splitters = paper.querySelectorAll('.new-page-start');
                    splitters.forEach(el => {
                        el.classList.remove('new-page-start');
                        el.style.marginTop = '';
                        el.removeAttribute('data-page-num');
                        el.removeAttribute('data-total-pages');
                    });
                    
                    // Remove all existing spacers
                    const existingSpacers = paper.querySelectorAll('.print-spacer');
                    existingSpacers.forEach(el => el.remove());

                    // 2. Constants
                    const PAGE_HEIGHT = reference.getBoundingClientRect().height; 
                    const CONTENT_PADDING_TOP = 60; 
                    const CONTENT_PADDING_BOTTOM = PAGE_HEIGHT * 0.025; // Reduced to 2.5% of page height
                    const GAP_HEIGHT = 50; 
                    
                    const paperTop = paper.getBoundingClientRect().top;

                    let currentLimit = PAGE_HEIGHT - CONTENT_PADDING_BOTTOM;
                    let pageCount = 1;
                    let breakElements = [];
                    
                    // 3. Iterate candidates
                    // Granular selection for continuous text flow
                    const candidatesSelector = `
                        .resume-header, 
                        .resume-section h3, 
                        .resume-item-header, 
                        .resume-item-subtitle, 
                        .resume-desc p, 
                        .resume-desc li, 
                        .resume-desc h4, 
                        .resume-desc h5, 
                        .resume-desc blockquote, 
                        .resume-desc pre,
                        .resume-desc table
                    `;
                    
                    const items = Array.from(paper.querySelectorAll(candidatesSelector));
                    
                    // Filter out items that are not visible or inside hidden containers? 
                    // querySelectorAll returns all matches. 
                    // We assume styles don't hide them unless module is hidden (which removes it from DOM).
                    
                    const headerTypes = ['H3', 'RESUME-ITEM-HEADER', 'RESUME-ITEM-SUBTITLE'];
                    
                    // Helper to check if element is a header type
                    const isHeader = (el) => {
                        if (!el) return false;
                        if (headerTypes.includes(el.tagName)) return true;
                        if (el.classList.contains('resume-item-header')) return true;
                        if (el.classList.contains('resume-item-subtitle')) return true;
                        return false;
                    };

                    for (let i = 0; i < items.length; i++) {
                        const el = items[i];
                        if (!el) continue;
                        
                        // Skip empty elements (like empty paragraphs from markdown) to prevent ghost pages
                        // Exception: elements with images or specific classes that might be visually relevant without text
                        if (!isHeader(el) && 
                            el.tagName !== 'HR' && 
                            !el.querySelector('img, svg, iframe') && 
                            el.textContent.trim().length === 0) {
                             continue;
                        }
                        
                        const rect = el.getBoundingClientRect();
                        const elHeight = rect.height;
                        const elTop = rect.top - paperTop;
                        const elBottom = elTop + elHeight;
                        
                        if (elBottom > currentLimit) {
                            let targetEl = el;
                            
                            // Recursive Orphan Protection REMOVED per user request
                            // (Previously moved headers to next page if content crossed line, causing large gaps)


                            // Re-calculate top for the target element
                            const targetRect = targetEl.getBoundingClientRect();
                            const targetTop = targetRect.top - paperTop;

                            const pushDist = (currentLimit + CONTENT_PADDING_BOTTOM + GAP_HEIGHT + CONTENT_PADDING_TOP) - targetTop;
                            
                            // Create a spacer element instead of modifying targetEl directly
                             // This solves the issue where list markers (bullets) get separated from text
                             let spacer;
                             if (targetEl.tagName === 'LI') {
                                 spacer = document.createElement('li');
                                 // list-style: none might not be enough, display: block ensures no marker is generated
                                 spacer.style.display = 'block'; 
                                 spacer.style.listStyle = 'none';
                             } else {
                                 spacer = document.createElement('div');
                                 spacer.style.display = 'block';
                             }
                             
                             spacer.className = 'print-spacer new-page-start'; // Add new-page-start to spacer for page numbering
                             
                             // We use fixed 60px height for the margin, as controlled by CSS .print-spacer
                             // But we can set it here too to be safe, or leave it to CSS.
                             // The pushDist calculation is legacy for the JS-only approach, 
                             // but we still need to track currentLimit correctly.
                             
                             // spacer.style.height is handled by CSS class .print-spacer (60px)
                             // For PREVIEW, we need to explicitly set the height to create the visual gap
                             spacer.style.height = `${Math.max(0, pushDist)}px`;
                             
                             // Insert spacer before target element
                             targetEl.parentNode.insertBefore(spacer, targetEl);
                             
                             // Store spacer reference for page numbering (kept for internal logic even if hidden)
                             spacer.setAttribute('data-page-num', pageCount);
                             breakElements.push(spacer);
                            
                            pageCount++;
                            currentLimit += (GAP_HEIGHT + PAGE_HEIGHT);
                        }
                    }

                    // Update total pages
                    // Total pages is pageCount (since pageCount starts at 1, and increments after each break. 
                    // If we have 1 break, we have 2 pages. pageCount becomes 2 after the break. So total is 2.
                    // Wait, if loop finishes with pageCount=2, it means we are on Page 2.
                    // So total pages is pageCount.
                    
                    breakElements.forEach(el => {
                        el.setAttribute('data-total-pages', pageCount);
                    });

                    // Ensure the last page is a full A4 page visually
                    const totalHeight = pageCount * PAGE_HEIGHT + (pageCount - 1) * GAP_HEIGHT;
                    paper.style.minHeight = `${totalHeight}px`;

                    // Generate background gradient for visual pages
                    let stops = [];
                    let curr = 0;
                    for(let i=0; i<pageCount; i++) {
                        // White block
                        stops.push(`white ${curr}px`);
                        stops.push(`white ${curr + PAGE_HEIGHT}px`);
                        // Gap (transparent)
                        if(i < pageCount - 1) {
                            stops.push(`transparent ${curr + PAGE_HEIGHT}px`);
                            stops.push(`transparent ${curr + PAGE_HEIGHT + GAP_HEIGHT}px`);
                            curr += (PAGE_HEIGHT + GAP_HEIGHT);
                        }
                    }
                    paper.style.backgroundImage = `linear-gradient(to bottom, ${stops.join(', ')})`;
                }

                return {
                    resume,
                    triggerUpload,
                    handleAvatarUpload,
                    removeAvatar,
                    addExperience,
                    removeExperience,
                    addWorkExperience,
                    removeWorkExperience,
                    editingProjectIndex,
                    currentProject,
                    resetProjectForm,
                    editProject,
                    removeProject,
                    saveProjectItem,
                    editingEducation,
                    isNewEducation,
                    currentEducation,
                    addNewEducation,
                    editEducation,
                    cancelEditEducation,
                    saveEducationItem,
                    removeEducation,
                    saveResume,
                    downloadPDF,
                    isDownloading,
                    showPagination,
                    currentTab,
                    calculatePagination,
                    saveTime,
                    compiledMarkdown,
                    compiledAwards,
                    compiledPersonalSummary,
                    compiledResearch,
                    previewStyles,
                    insertText,
                    renderMarkdown,
                    showConfigModal,
                    showAddModuleModal,
                    newModuleTitle,
                    addNewModule,
                    currentConfigTab,
                    globalConfig,
                    allModules,
                    moduleOrder,
                    openConfigModal,
                    toggleModuleVisibility,
                    moveModule,
                    saveConfig,
                    draggedIndex,
                    dragOverIndex,
                    onDragStart,
                    onDragEnter,
                    onDragEnd,
                    onDrop
                }
            }
        }).mount('#app')
    </script>
    {% endverbatim %}
</body>
</html>